<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>sideproject</title>
	<meta name="description" content="">
	<meta name="author" content="mnath">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="../../../../theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="../../../../theme/bootstrap.min.css" rel="stylesheet">
	<link href="../../../../theme/local.css" rel="stylesheet">
	<link href="../../../../theme/pygments.css" rel="stylesheet">

	<!-- Feeds -->




</head>
<body>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="../../../../">sideproject</a>
			<ul class="nav">
					<li><a href="/">home</a></li>
					<li ><a href="../../../../category/blog">blog</a></li>
					<li class="active"><a href="../../../../category/project">project</a></li>
					<li ><a href="../../../../category/reading">reading</a></li>
			</ul>
			<p class="pull-right"><a href="../../../../archives.html">[archives]</a> <a href="../../../../tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	  <div class="content">
	<div class='article'>
		<div class="page-header"><h1>How I setup Pelican</h1></div>
		<div class="well small">Permalink: <a class="more" href="../../../../posts/2013/07/pelican-setup/">2013-07-01 00:00:00</a>
by <a class="url fn" href="../../../../author/mnath.html">mnath </a>
 in <a href="../../../../category/project">project</a>
tags: <a href="../../../../tag/webdev/">webdev</a> </div>
		<div><!-- PELICAN_BEGIN_SUMMARY -->

<div id="wrapper" style="width:100%; text-align:center">
    <img src="http://terriyu.info/blog/static/images/pelican-800px.png" alt="Pelican logo and Github account" />
</div>

<p><br /></p>
<p>I thought it would be useful to go into greater technical detail about how I
went about setting up Pelican.<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup></p>
<p>My machine is running Ubuntu 12.04 LTS.</p>
<!-- PELICAN_END_SUMMARY -->

<p>Summary:</p>
<ol>
<li>Install Pelican and its dependencies in a virtual environment.  </li>
<li>Run <code>pelican-quick-start</code> </li>
<li>Fork the <a href="https://github.com/getpelican/pelican-themes">Pelican themes</a> and
   <a href="https://github.com/getpelican/pelican-plugins">Pelican plugins</a> on GitHub
   and clone the forks onto my local machine.  </li>
<li>Modify Pelican themes to my taste.  I modified the bootstrap theme.</li>
<li>Make additional directories inside <code>content</code> directory.</li>
<li>Modify settings in <code>pelicanconf.py</code> and <code>publishconf.py</code></li>
<li>Setup <a href="http://www.google.com/analytics/">Google Analytics</a>/<a href="http://piwik.org/">Piwik</a> 
   and <a href="http://disqus.com/">Disqus</a>.</li>
</ol>
<h2>Demonstration</h2>
<p>If you'd like to see some of Pelican's features in action
(Markdown, formatting, $\LaTeX$, etc.), see my earlier post on
<a href="|filename|pelican-demo.md">demonstrating Pelican</a>.</p>
<h2>Installing Pelican and dependencies</h2>
<p>To install Pelican and other Python package dependencies in a virtual 
environment, I followed the instructions in the official 
<a href="http://docs.getpelican.com/en/3.2/getting_started.html#installing-pelican">Pelican documentation</a>. </p>
<div class="highlight"><pre><span class="gp">$</span> virtualenv ~/virtualenvs/pelican
<span class="gp">$</span> <span class="nb">cd</span> ~/virtualenvs/pelican
<span class="gp">$</span> . bin/activate
<span class="gp">$</span> pip install pelican
<span class="gp">$</span> pip install Markdown
</pre></div>


<p>Don't use <code>sudo pip</code> when installing these Python packages in a virtual 
environment, otherwise you'll end up installing them globally which defeats the 
purpose of using virtual environments.</p>
<p>I wanted to use <a href="http://daringfireball.net/projects/markdown">Markdown</a> to write
my blog posts, so I needed to install the Python Markdown package in the last
line.  By default, Pelican uses a 
<a href="http://pythonhosted.org/Markdown/extensions/extra.html">flavor of Markdown</a>
that mostly follows 
<a href="http://michelf.ca/projects/php-markdown/extra/">PHP Markdown Extra</a>.  I
especially like using the 
<a href="http://pythonhosted.org/Markdown/extensions/footnotes.html">footnotes extension</a>.</p>
<p>After you're done working with Pelican, you can leave the virtual environment
with</p>
<div class="highlight"><pre><span class="gp">$</span> deactivate
</pre></div>


<h2>Running pelican-quickstart</h2>
<p>Here are the configuration options I used for <code>pelican-quickstart</code>.  The details
for SSH upload have been anonymized for security reasons.</p>
<div class="highlight"><pre><span class="gp">$</span> pelican-quickstart
<span class="go">Welcome to pelican-quickstart v3.2.2.</span>

<span class="go">This script will help you create a new Pelican-based website.</span>

<span class="go">Please answer the following questions so this script can generate the files</span>
<span class="go">needed by Pelican.</span>

<span class="gp">&gt;</span> Where <span class="k">do </span>you want to create your new web site? <span class="o">[</span>.<span class="o">]</span> blog
<span class="gp">&gt;</span> What will be the title of this web site? terriyu@/media/blog 
<span class="gp">&gt;</span> Who will be the author of this web site? Terri Yu 
<span class="gp">&gt;</span> What will be the default language of this web site? <span class="o">[</span>en<span class="o">]</span> 
<span class="gp">&gt;</span> Do you want to specify a URL prefix? e.g., http://example.com   <span class="o">(</span>Y/n<span class="o">)</span> Y
<span class="gp">&gt;</span> What is your URL prefix? <span class="o">(</span>see above example; no trailing slash<span class="o">)</span> http://terriyu.info
<span class="gp">&gt;</span> Do you want to <span class="nb">enable </span>article pagination? <span class="o">(</span>Y/n<span class="o">)</span> Y
<span class="gp">&gt;</span> How many articles per page <span class="k">do </span>you want? <span class="o">[</span>10<span class="o">]</span> 
<span class="gp">&gt;</span> Do you want to generate a Makefile to easily manage your website? <span class="o">(</span>Y/n<span class="o">)</span> Y
<span class="gp">&gt;</span> Do you want an auto-reload &amp; simpleHTTP script to assist with theme and site development? <span class="o">(</span>Y/n<span class="o">)</span> Y
<span class="gp">&gt;</span> Do you want to upload your website using FTP? <span class="o">(</span>y/N<span class="o">)</span> N
<span class="gp">&gt;</span> Do you want to upload your website using SSH? <span class="o">(</span>y/N<span class="o">)</span> Y
<span class="gp">&gt;</span> What is the hostname of your SSH server? <span class="o">[</span>localhost<span class="o">]</span> ip.add.ress
<span class="gp">&gt;</span> What is the port of your SSH server? <span class="o">[</span>22<span class="o">]</span> 
<span class="gp">&gt;</span> What is your username on that server? <span class="o">[</span>root<span class="o">]</span> username 
<span class="gp">&gt;</span> Where <span class="k">do </span>you want to put your web site on that server? <span class="o">[</span>/var/www<span class="o">]</span> /somedirectory 
<span class="gp">&gt;</span> Do you want to upload your website using Dropbox? <span class="o">(</span>y/N<span class="o">)</span> N
<span class="gp">&gt;</span> Do you want to upload your website using S3? <span class="o">(</span>y/N<span class="o">)</span> N
</pre></div>


<p>I enabled article pagination so that I didn't end up with all the posts on a
single page.  The <code>Makefile</code> is incredibly useful, so I enabled that.  It allows
you to compile the website with <code>make html</code> or <code>make devserver</code>.  Usually, when
I want to test my website, I run <code>make clean</code> (to delete any previously 
generated files), followed by <code>make devserver</code> to run a fake server on my local
machine.  I find that <code>make devserver</code> is a better simulation of the website
than <code>make html</code>.  I'm not sure what the auto-reload &amp; simpleHTTP script is, but
I enabled it just in case.</p>
<p>When I'm ready to upload my content to the web host, there are a variety of 
options.  I don't enable FTP upload because it's not very secure.  I try to
stick with some transfer method that uses SSH.  You can use <code>make ssh_upload</code>
which works fine, but I prefer <code>make rsync_upload</code> which uploads using <code>rsync</code>
and SSH.  Unlike <code>make ssh_upload</code> which uses <code>scp</code> and uploads everything, the 
<code>rsync</code> command only sends incremental changes, which makes your data transfer 
much more efficient. </p>
<p>All the <code>make</code> commands have to be run in the same directory as the <code>Makefile</code>.</p>
<h2>Fork and clone the GitHub repos for pelican-themes and pelican-plugins</h2>
<p>I wanted to modify the official 
<a href="https://github.com/getpelican/pelican-themes">Pelican themes</a> and 
<a href="https://github.com/getpelican/pelican-plugins">Pelican plugins</a>, and have them
under version control, so I performed the standard procedure of forking the 
GitHub repos and cloning the forks.  My procedure was very similar to the
<a href="https://help.github.com/articles/fork-a-repo">GitHub help page</a> except I cloned
using the SSH address rather than the https address.</p>
<h2>Modify Pelican theme to taste</h2>
<p>I am using the bootstrap theme.  I modified it in the following way:</p>
<ul>
<li>Modified <code>static/bootstrap.min.css</code><ul>
<li>Increased font size and line height</li>
<li>Changed sizes and alignment of top bar, sidebar, and content</li>
<li>Eliminated line in page header</li>
</ul>
</li>
<li>Modified <code>bootstrap/static/local.css</code><ul>
<li>Changed icons to use 
  <a href="http://fortawesome.github.io/Font-Awesome/">Font Awesome</a>'s set</li>
<li>Changed alignment of icons</li>
</ul>
</li>
<li>Modified <code>static/pygments.css</code> to use the perldoc colors by
  <a href="http://pygments.org/docs/cmdline/#generating-styles">generating a CSS stylesheet</a> </li>
<li>Added code to <code>templates/article.html</code> for neighboring links.  This means that
  if you are on a post, you will see a link for the previous post and a link
  for the next post.  You need to enable the 
  <a href="https://github.com/getpelican/pelican-plugins/tree/master/neighbors">neighbors plugin</a> 
  for this to work. </li>
<li>Modified <code>templates/base.html</code><ul>
<li>Added code for including $\LaTeX$.  For this to work, you need to enable
  the <a href="https://github.com/getpelican/pelican-plugins/tree/master/latex">latex plugin</a>.</li>
<li>Added code for including Piwik content</li>
<li>Altered sidebar links</li>
</ul>
</li>
<li>Modified <code>templates/index.html</code> to change look of the more... link in the 
  summaries, got rid of the permalink line, and added the date before each post 
  title</li>
<li>Modified <code>templates/metadata.html</code> to use the variable <code>article.locale_date</code>
  instead of <code>article.date</code> so that it uses my <code>DEFAULT_DATE_FORMAT</code> variable
  in <code>pelicanconf.py</code></li>
<li>Added <code>templates/piwik.html</code> (copied from bootstrap2 theme) for Piwik support</li>
<li>Modified <code>templates/tags.html</code> to sort tags in alphabetical order </li>
</ul>
<p>To sort tags in alphabetical order, use</p>
<div class="highlight"><pre><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">articles</span> <span class="n">in</span> <span class="n">tags</span><span class="o">|</span><span class="n">sort</span> <span class="o">%</span><span class="p">}</span>
</pre></div>


<h2>Make additional directories inside content directory</h2>
<p>I made directories <code>2013</code>, <code>images</code>, and <code>pages</code> in the <code>content</code> 
directory.  This is the way I organized my content.  Posts in 2013 go into 
<code>2013</code>, photos go into <code>images</code>, and special non-chronological content goes into 
<code>pages</code>.  I plan to make a new directory for each year and it would contain the 
posts for that particular year.  The only directory that has to have a specific 
name is <code>pages</code>.  Pelican treats this name as special.  My 
<a href="../../../../">About page</a> is contained inside the directory 
<code>pages</code>.</p>
<p>For more information about the file hierarchy, see the 
<a href="http://docs.getpelican.com/en/3.2/getting_started.html#kickstart-your-site">Pelican documentation</a>.</p>
<h2>Modify settings in pelicanconf.py and publishconf.py</h2>
<p>This is my <code>pelicanconf.py</code> file.</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*- #</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="n">AUTHOR</span> <span class="o">=</span> <span class="s">u&#39;Terri Yu&#39;</span>
<span class="n">SITENAME</span> <span class="o">=</span> <span class="s">u&#39;terriyu@/media/blog&#39;</span>
<span class="n">SITEURL</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<span class="n">TIMEZONE</span> <span class="o">=</span> <span class="s">&#39;America/New_York&#39;</span>

<span class="n">DEFAULT_LANG</span> <span class="o">=</span> <span class="s">u&#39;en&#39;</span>

<span class="c"># Feed generation is usually not desired when developing</span>
<span class="n">FEED_ALL_ATOM</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">CATEGORY_FEED_ATOM</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">TRANSLATION_FEED_ATOM</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c"># Feeds </span>
<span class="n">FEEDS</span> <span class="o">=</span>  <span class="p">((</span><span class="s">&#39;All posts&#39;</span><span class="p">,</span> <span class="s">&#39;feeds/all.atom.xml&#39;</span><span class="p">),</span>
          <span class="p">(</span><span class="s">&#39;Category&#39;</span><span class="p">,</span> <span class="s">&#39;feeds/category&#39;</span><span class="p">),</span>
          <span class="p">(</span><span class="s">&#39;OPW&#39;</span><span class="p">,</span> <span class="s">&#39;feeds/tag/opw.atom.xml&#39;</span><span class="p">),)</span>

<span class="c"># Social widget</span>
<span class="n">SOCIAL</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;Github&#39;</span><span class="p">,</span> <span class="s">&#39;https://github.com/terriyu&#39;</span><span class="p">),</span>
          <span class="p">(</span><span class="s">&#39;Twitter&#39;</span><span class="p">,</span> <span class="s">&#39;https://twitter.com/terrimyu&#39;</span><span class="p">),</span>
          <span class="p">(</span><span class="s">&#39;Linkedin&#39;</span><span class="p">,</span> <span class="s">&#39;https://linkedin.com/in/terriyu&#39;</span><span class="p">),)</span>

<span class="n">DEFAULT_PAGINATION</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c"># Uncomment following line if you want document-relative URLs when developing</span>
<span class="n">RELATIVE_URLS</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># Formatting for dates</span>

<span class="n">DEFAULT_DATE_FORMAT</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;%a </span><span class="si">%d</span><span class="s"> %B %Y&#39;</span><span class="p">)</span>

<span class="c"># Formatting for urls</span>

<span class="n">ARTICLE_URL</span> <span class="o">=</span> <span class="s">&quot;posts/{date:%Y}/{date:%m}/{slug}/&quot;</span>
<span class="n">ARTICLE_SAVE_AS</span> <span class="o">=</span> <span class="s">&quot;posts/{date:%Y}/{date:%m}/{slug}/index.html&quot;</span>

<span class="n">CATEGORY_URL</span> <span class="o">=</span> <span class="s">&quot;category/{slug}&quot;</span>
<span class="n">CATEGORY_SAVE_AS</span> <span class="o">=</span> <span class="s">&quot;category/{slug}/index.html&quot;</span>

<span class="n">TAG_URL</span> <span class="o">=</span> <span class="s">&quot;tag/{slug}/&quot;</span>
<span class="n">TAG_SAVE_AS</span> <span class="o">=</span> <span class="s">&quot;tag/{slug}/index.html&quot;</span>

<span class="c"># Generate yearly archive</span>

<span class="n">YEAR_ARCHIVE_SAVE_AS</span> <span class="o">=</span> <span class="s">&#39;posts/{date:%Y}/index.html&#39;</span>

<span class="c"># Show most recent posts first</span>

<span class="n">NEWEST_FIRST_ARCHIVES</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c"># Specify theme</span>

<span class="n">THEME</span> <span class="o">=</span> <span class="s">&quot;/home/terri/pelican/pelican-themes/bootstrap&quot;</span>

<span class="c"># Plugins</span>

<span class="n">PLUGIN_PATH</span> <span class="o">=</span> <span class="s">&#39;/home/terri/pelican/pelican-plugins&#39;</span>
<span class="n">PLUGINS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;latex&#39;</span><span class="p">,</span> <span class="s">&#39;neighbors&#39;</span><span class="p">,</span> <span class="s">&#39;summary&#39;</span><span class="p">]</span>

<span class="c"># Only use LaTeX for selected articles</span>

<span class="n">LATEX</span> <span class="o">=</span> <span class="s">&#39;article&#39;</span>
</pre></div>


<p>The configuration file is mostly self-explanatory.  I uncommented the line for
relative URLs.  I also specified custom URLs for article, category, tag, and
year archive, so that the URLs are more concise and don't have any <code>.html</code>
extension.  For example, instead of <code>posts/2013/06/pelican-setup.html</code>, I would
have <code>posts/2013/06/pelican-setup/</code>.  I added lines to show most recent posts
first and to use the <code>bootstrap</code> theme.  I also enabled the <code>latex</code>, 
<code>neighbors</code>, and <code>summary</code> plugins.  The line <code>LATEX = 'article'</code> allows you to 
turn on $\LaTeX$ support by adding the line <code>Latex:</code> in the head of a post.  I
like using the <code>summary</code> plugin<sup id="fnref:2"><a class="footnote-ref" href="#fn:2" rel="footnote">2</a></sup> because I can control exactly how much of each
post is shown on the index page by using markers.  Also, if I set the 
<code>&lt;!-- PELICAN_END_SUMMARY --&gt;</code> marker before footnotes, then I avoid the
<a href="https://github.com/getpelican/pelican/pull/885">bug where footnotes appear in the summary</a>. </p>
<p>Below is my <code>publishconf.py</code> file with the Disqus and Google Analytics 
specifics anonymized.</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*- #</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="c"># This file is only used if you use `make publish` or</span>
<span class="c"># explicitly specify it as your config file.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pelicanconf</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">SITEURL</span> <span class="o">=</span> <span class="s">&#39;http://terriyu.info/blog&#39;</span>
<span class="n">RELATIVE_URLS</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">FEED_ALL_ATOM</span> <span class="o">=</span> <span class="s">&#39;feeds/all.atom.xml&#39;</span>
<span class="n">CATEGORY_FEED_ATOM</span> <span class="o">=</span> <span class="s">&#39;feeds/category/</span><span class="si">%s</span><span class="s">.atom.xml&#39;</span>
<span class="n">TAG_FEED_ATOM</span> <span class="o">=</span> <span class="s">&#39;feeds/tag/</span><span class="si">%s</span><span class="s">.atom.xml&#39;</span>

<span class="n">DELETE_OUTPUT_DIRECTORY</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># Following items are often useful when publishing</span>

<span class="n">DISQUS_SITENAME</span> <span class="o">=</span> <span class="s">&#39;disqus-sitename&#39;</span>
<span class="n">GOOGLE_ANALYTICS</span> <span class="o">=</span> <span class="s">&#39;google-analytics-id&#39;</span>

<span class="n">PIWIK_URL</span> <span class="o">=</span> <span class="s">&#39;url.where.piwik.install.is.located&#39;</span>
<span class="c">#PIWIK_SSL_URL = &#39;&#39;</span>
<span class="n">PIWIK_SITE_ID</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span>
</pre></div>


<p>I mostly kept the default file, but added a tag feed.</p>
<h2>Setup Google Analytics/Piwik and Disqus</h2>
<p>Just go to the relevant website 
<a href="http://www.google.com/analytics/">Google Analytics</a>, 
<a href="http://piwik.org/">Piwik</a>, or <a href="http://disqus.com/">Disqus</a> and follow the
directions on how to set it up.  Then add the appropriate IDs to your 
<code>publishconf.py</code> file (see my example file from the last section).  Piwik needs 
to be installed on a server.  The major web hosts 
<a href="http://www.bluehost.com/">Bluehost</a> and <a href="http://dreamhost.com/">Dreamhost</a> 
support one-click Piwik installs.  Or, if you have a friend who is willing to 
share their Piwik install with you, that also works.  The variable 
<code>PIWIK_SSL_URL</code> is for extra security and optional.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Top image taken from <a href="https://github.com/getpelican/">Pelican GitHub page</a>&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Currently, there is an incompatibility between the <code>summary</code> plugin and 
  the version 3.2 release of the Pelican package.  The <code>summary</code> plugin in the
  <a href="https://github.com/getpelican/pelican-plugins">pelican-plugins GitHub repository</a>
  has been updated to be consistent with the development version of
  Pelican.  Therefore, if you try to use the latest <code>summary</code> plugin from 
  the GitHub repo with Pelican v3.2, you'll get an error related to the
  <code>DEFAULT_CONFIG</code> variable.  To fix this, go into your cloned Git
  repo of <code>pelican-plugins</code> and manually change the code in 
  <code>summary/summary.py</code>.  Simply replace <code>DEFAULT_CONFIG</code> with 
  <code>_DEFAULT_CONFIG</code> in the file.  See this 
  <a href="https://github.com/getpelican/pelican-plugins/pull/33/files">pull request</a>
  for reference.&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
	</div>
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; mnath</p>
		</footer>
	  </div>

	</div>
</body>
</html>